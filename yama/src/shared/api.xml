<?xml version="1.0" encoding="utf-8" ?>
<api name="yama">
  <type name="Book">
    <field name="id" type="id" />
    <field name="name" type="string" />
    <!-- datetime is utc and iso8601 -->
    <field name="createTime" type="datetime?" />
    <field name="updateTime" type="datetime?" />
    <!-- all sections in book -->
    <field name="sections" type="Section[]" />
    <!-- pages that belong directly to book (not in any section) -->
    <field name="pages" type="Page[]" />
  </type>
  <type name="Section">
    <field name="id" type="id" />
    <!-- null for parent means root level section -->
    <field name="parentId" type="id?" />
    <field name="name" type="string" />
    <field name="createTime" type="datetime?" />
    <field name="updateTime" type="datetime?" />
    <field name="sections" type="Section[]" />
    <field name="pages" type="Page[]" />
  </type>
  <type name="Page">
    <field name="id" type="id" />
    <field name="name" type="string" />
    <field name="content" type="string" />
    <field name="createTime" type="datetime?" />
    <field name="updateTime" type="datetime?" />
    <field name="shareId" type="string?" />
    <field name="files" type="EmbeddedFile[]" />
  </type>
  <type name="PageHistory">
    <field name="id" type="id" />
    <field name="name" type="string" />
    <field name="createTime" type="datetime?" />
    <field name="operations" type="PageOperation[]" />
  </type>
  <type name="PageOperation">
    <field name="historyId" type="id" />
    <field name="kind" type="string" />
    <field name="line" type="int" />
    <field name="content" type="string" />
  </type>
  <type name="EmbeddedFile">
    <field name="id" type="id" />
    <field name="name" type="string" />
    <!-- base64 encoded binary content -->
    <field name="content" type="string" />
    <field name="createTime" type="datetime?" />
  </type>
  <type name="SharePageResult">
    <field name="id" type="string" />
  </type>
  <type name="Query">
    <field name="includeBookName" type="bool" />
    <field name="includeSectionName" type="bool" />
    <field name="includePageName" type="bool" />
    <field name="includePageContent" type="bool" />
    <field name="bookId" type="id?" />
    <field name="regex" type="bool" />
    <field name="content" type="string" />
  </type>
  <type name="QueryResult">
    <!-- matched book id + name -->
    <field name="Books" type="Book[]" />
    <!-- matched section id + name -->
    <field name="SectionNames" type="Section[]" />
    <!-- matched page id + name -->
    <!-- if page name match query.content, display it, else it is content match -->
    <field name="PageNames" type="Page[]" />
  </type>
  <!-- get book id + name -->
  <action key="main" name="GetBooks" return="Book[]" />
  <!-- get id, name, sections, page id + names -->
  <action key="main" name="GetBook" a1="bookId" return="Book" />
  <!-- only use body.name -->
  <action key="main" name="AddBook" body="Book" return="Book" />
  <!-- update book name -->
  <action key="main" name="UpdateBook" body="Book" return="Book" />
  <!-- TODO not allow remove book when there is any page -->
  <action key="main" name="RemoveBook" a1="bookId" />
  <!-- creates section in specified book, under optional parent section -->
  <action key="main" name="AddSection" a1="bookId" a2="sectionId?" return="Section" />
  <action key="main" name="UpdateSection" a1="bookId" body="Section" return="Section" />
  <action key="main" name="MoveSection" a1="bookId" a2="sectionId" a3="newParentId?" />
  <!-- TODO not allow remove section where there is any page -->
  <action key="main" name="RemoveSection" a1="bookId" a2="sectionId" />
  <action key="main" name="GetPage" a1="pageId" return="Page" />
  <action key="share" name="PublicGetPage" public="true" a1="shareId:guid" return="Page" />
  <!-- create empty page, only use body.name, use default name if no body.name -->
  <action key="main" name="AddPage" a1="bookId" a2="sectionId?" body="Page" return="Page" />
  <!-- update page name or content -->
  <action key="main" name="UpdatePage" body="Page" return="Page" />
  <action key="main" name="MovePage" a1="pageId" a2="newSectionId?" />
  <action key="main" name="SharePage" a1="pageId" return="SharePageResult" />
  <action key="main" name="UnsharePage" a1="pageId" />
  <action key="main" name="RemovePage" a1="pageId" />
  <!-- Page history operations -->
  <action key="main" name="GetPageHistories" a1="pageId" return="PageHistory[]" />
  <action key="main" name="GetPageHistory" a1="pageId" a1="historyId" return="PageHistory" />
  <!-- create new history version (manual save) -->
  <action key="main" name="SavePageVersion" a1="pageId" body="PageHistory" return="PageHistory" />
  <!-- restore page content to a specific history version -->
  <action key="main" name="RestorePageVersion" a1="pageId" a2="historyId" return="Page" />
  <action key="main" name="RemovePageVersion" a1="historyId" />
  <!-- Embedded file operations -->
  <action key="main" name="GetPageFiles" a1="pageId" return="EmbeddedFile[]" />
  <action key="main" name="GetPageFile" a1="fileId" return="EmbeddedFile" />
  <action key="main" name="AddPageFile" a1="pageId" body="EmbeddedFile" return="EmbeddedFile" />
  <action key="main" name="UpdatePageFile" body="EmbeddedFile" return="EmbeddedFile" />
  <action key="main" name="RemovePageFile" a1="fileId" />
  <!-- Search operations -->
  <action key="main" name="Search" body="Query" return="QueryResult" />
</api>